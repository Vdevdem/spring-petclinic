pipeline {
    agent any

    stages {
        stage ('Checkout'){
          steps {
              cleanWs()
              git branch: 'main', credentialsId: 'Git_FProject', url: 'https://github.com/Vdevdem/spring-petclinic.git'
          }
         }

        stage('build') {
          steps {
                echo 'Build Start'

                bat"""
                rem git clone https://github.com/Vdevdem/spring-petclinic.git
                mvn package

                """
               }
          }


          stage ('Upload artifact to s3'){
            try {
              withCredentials([[$class:'AmazonWebServicesCredentialsBinding', accessKeyVariable:'AWS_ACCESS_KEY_ID',credentialsId:'deployuser', secretKeyVariable:'AWS_SECRET_ACCESS_KEY']]) {
              bat"""
                aws s3 dir
                aws s3 mb s3://cloudart-bucket-for-aws
                s3Upload(file:"${target/spring-petclinic-2.7.3.jar}", bucket:"${cloudart-bucket-for-aws}")
                }

              """
                } catch(err)  {
                    echo 'error in sending artifacts to s3'
                }
            }
    }
}
