pipeline {
    agent any

    stages {
        stage ('Checkout'){
          steps {
              cleanWs()
              git branch: 'main', credentialsId: 'Git_FProject', url: 'https://github.com/Vdevdem/spring-petclinic.git'
          }
         }

        stage('build') {
          steps {
                echo 'Build Start'

                bat"""
                rem git clone https://github.com/Vdevdem/spring-petclinic.git

                mvn package
                java -Dserver.port=8888 -jar target/*.jar
                """
               }
          }

          stage('Create Docker Container') {
              steps {
                  echo 'Start creating Docker Container'
                  bat"""
                  cd spring-petclinic 
                  ./mvnw spring-boot:build-image
                  docker tag spring-petclinic:2.7.0-SNAPSHOT docker:5000/petclinic:v$BUILD_NUMBER
                  """
                  echo 'End creating Docker Container'
              }
          }
                                      
          stage('Push Docker Container to Docker Registry') {
              steps {
                 echo 'Stast push Docker Container to Docker Registry'
                 bat"""
                 docker push docker:5000/petclinic:v$BUILD_NUMBER 
                 """
                 echo 'End push Docker Container to Docker Registry'
              }
          }
         
    }
}
